# CDF Functions

## get_unique_list
Input list or lists

Return a list of the unique items

## compare_list_lengths
input lists 

Return true if lists are all the same length, otherwise return false

## remove_nan
Input list

Return list with null values removed

## get_col_slice
Input dataframe (df), unique identifier (uid), mask column (mask_col) and target column (tgt_col)

Slices the dataframe on the mask column based on the unique identifier and returns values from the
target column as a list.

## get_df_slice
Input dataframe (df), slice column (slice_col), slice value (slice_val) and list of return columns 
(rtn_cols)

This function slices the input dataframe on the defined slice col using the slice value and returns 
a dataframe consisting of the return columns specified.

## get_time_val
input a time string of either hh:mm:ss or day.hh:mm:ss format. Input return unit (unit) and zero hour 
(zero_hr)

Returns a value representing a time from 00:00:00

Return time can be in hours, minutes or seconds by passing 'hrs', 'mins' or 'secs' as the unit argument 
(default is 'hrs') and a number of hours can be subtracted from the return value by passing a value
in hours as the zero_hr argument (default 0)

## row_per_event
Input dataframe (input_df), column with the count of events (event_count_col) and whether to drop 
rows with zero event count (drop_zero).

This function takes in a dataframe and returns that dataframe with each row repeated a number of times
based on the value in the specified event count column. i.e. if the event count column for a row is 2 
then that row will be repeated twice in the returned dataframe.

By default, rows with values of 0 in the event count column are dropped but this can be prevented by 
passing False for the drop_zero argument.

## flashpoint_str_extract
Input a flashpoint data string (input_str) and how to format the output (output_by_group)

This function takes in a flashpoint data string with groups of items separated by , and items within
groups separated by | (i.e. a|b,c|d,e|f) and returns the items as a list object.

By default, items are returned with a list for each of the original groups:
    
    [[a,b] [c,d], [e,f]

but they can be returned with a list for each group position by passing False as the output_by_group 
argument:

    [[a,c,e],[b,d,f]]  
 
## flashpoint_event_pivot
Input all events data frame (all_event_df), target event type (event_type) and a list of the event
keys to return the values for (key_ls)

This function works with the all event dataframe (events_all_df) generated by phase 2 of the 
flashpoint processing script. 

It slices the all event dataframe for selected event type and returns a pivoted dataframe with a column for
each of the selected keys.

## flashpoint_add_coord_cols
Input event dataframe (event_df), column containing hex numbers (hex_col), map data frame (map_df)
and the labels for the x and y columns that will be added (x_lbl), (y_lbl)

This function takes in an event data frame with a column containing hex numbers and adds on x and y 
coordinates from the map dataframe generated from the flashpoint map.csv file. The x and y column
names in the returned dataframe are set by the x_lbl and y_lbl arguments.  

## flashpoint_kills_from_lists
Input dataframe (input_df), kia list column (kia_col_lbl), fall out list column (fall_col_lbl)

This functions takes in a dataframe with a kia list column and fall out list column and returns the 
same dataframe with a numerical 'Kills' column. The value in the Kills column will be the number of
items in the kia and fall out lists. This function can be used in combination with the row_per_event
function, using the 'Kills' column as the event count column. 

## setup_logger
Input name of the logger (name)

This function sets up a logger object with pre-set formatting and handlers. This function is called
by the dataset class to set up the dataset logger and should also be called by model processor scripts
to set up a script logger.

The file handler saves the log files in the /Output folder, the log files will include all events down
to debug level however the stream handler will only stream handler will only display events Info level
and above.

## encode_event_detail_list
Input any number of lists of detail values (detail_val_cols*) and a list of detail keys (detail_keys).

There must be an item in the detail_keys list for each list of detail values, they must be in 
the same order and all the lists of detail values must be of the same length.

This function returns a list of json strings, each consisting of key-value pairs. 

The set of key-value pairs for the first json string in the output list is generated by combining (in order) 
the keys from the detail_keys list with the first item from each of the detail_val_cols lists to form 
key-value pairs, the second set by combining the keys with the second item from each of the detail_val_cols 
lists and so on. i.e.

    detail_val_cols = [d1_val1, d1_val2], [d2_val1, d2_val2] detail_keys = [key1, key2] 
    
    output:
    ['{"key1":"d1_val1", "key2":"d2_val1"}', '{"key1":"d1_val2", "key2":"d2_val2"}'] 

This function is used in the model processor scripts to encode event detail lists before feeding them 
into the append_to_list function in the dataset class. 

## encode_event_detail
Input list of keys for the detail entry (detail_key_ls) and a list of values (detail_val_ls)

The list of keys and list of values must be of the same length.

This function returns a list of key value pairs formatted as a json string.
Keys and values are enclosed in double quotes and separated by a colon, pairs are separated by a comma 
followed by a space and the whole list is enclosed within curly braces i.e. 
    
    detail_key_ls = [key1, key2, key3] detail_val_ls = [val1, val2, val3]
    
    output:
    '{"key1":"val1", "key2":"val2", "key3":"val3"}'

The function is used directly by the add single event methods in the Dataset class i.e. add_location,
add_shot, add_kill, add_loss, add_spot, add_seen to encode the detail entry for the CDF event. It
is also utilised by the encode_event_detail_list function (see above) to generate a list of key-value
pair detail strings.

## parse_config_bool
Input a 1 / 0 value from a run configuration, return True / False equivalent as a boolean.

## parse_config_location
Input a location string from a run configuration, return a path string formatted correctly for the operating system
environment.

## batch_run_processor
Runs a batch of configurations from a configuration file with a model processor function. 
Has options for sequential or paralell processing and generates a batch log file that records the outcome for each configuration.